<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Notas e Faltas</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Handlee&family=Nunito&display=swap" rel="stylesheet" />

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />

    <!-- Flaticon Font -->
    <link href="./../../../../lib/flaticon/font/flaticon.css" rel="stylesheet" />

    <!-- Libraries Stylesheet -->
    <link href="./../../../../lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
    <link href="./../../../../lib/lightbox/css/lightbox.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="./../../../../css/style.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Navbar Start -->
    <div class="container-fluid bg-light shadow">
      <nav class="navbar navbar-expand-lg navbar-light py-3 px-5">
        <a href="#" class="navbar-brand font-weight-bold text-secondary" style="font-size: 40px">
          <i class="fas fa-user-graduate"></i> <span class="text-primary">Notas e Faltas</span>
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
          <div class="navbar-nav font-weight-bold mx-auto">
            <a href="./../../aluno/area_Aluno.html" class="nav-item nav-link">Área do Aluno</a>
          </div>
          <a href="logout.html" class="btn btn-danger px-4">Sair</a>
        </div>
      </nav>
    </div>
    <!-- Navbar End -->

    <!-- Content Start -->
    <div class="container my-5">
      <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 mb-4">
          <div class="bg-light shadow rounded p-4">
            <h4 class="text-primary">Menu</h4>
            <ul class="list-unstyled">
              <li><a href="./../../aluno/area_Aluno.html" class="text-dark"><i class="fas fa-user-circle"></i> Voltar ao Dashboard</a></li>
            </ul>
          </div>
        </div>
        <!-- Main Section -->
        <div class="col-md-9">
          <!-- Tabela de Notas e Faltas -->
          <section id="notas_faltas" class="mb-5">
            <h4 class="text-primary">Notas e Faltas</h4>
            <table class="table table-striped">
              
            </table>
          </section>
        </div>
      </div>
    </div>
    <!-- Content End -->

    <!-- Footer Start -->
    <div class="container-fluid bg-secondary text-white mt-5 py-1 px-sm-3 px-md-5" style="position:relative; bottom: 0">
      <div class="row pt-5 d-flex justify-content-center">
        <div class="col-lg-3 col-md-6 mb-5">
          <a href="./../../../../index.html" class="navbar-brand font-weight-bold text-primary m-0 mb-4 p-0"
            style="font-size: 40px; line-height: 40px">
            <i class="flaticon-043-teddy-bear"></i>
            <span class="text-white ">Toth Academy</span>
          </a>
        </div>
      </div>    
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary p-3 back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="./../../../../lib/easing/easing.min.js"></script>
    <script src="./../../../../lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="./../../../../lib/lightbox/js/lightbox.min.js"></script>

    <!-- Template Javascript -->
    <script src="./../../../../js/main.js"></script>
    <script>
      // Exemplo de dados simulados
      let notas = JSON.parse(localStorage.getItem("notas")) || [];
      let alunos = JSON.parse(localStorage.getItem("alunos")) || [];
      let professores = JSON.parse(localStorage.getItem("professores")) || [];
      let usuarioAtual = JSON.parse(localStorage.getItem("usuarioAtual")) || [];
      let disciplinas = JSON.parse(localStorage.getItem("disciplinas")) || [];


      function carregarNotas() {
          let usuario;
          let html = "";
          let tabela = document.getElementById("lista_notas");

          alunos.forEach(e => {
            if(usuarioAtual == e.id) usuario = "A";
          });

          professores.forEach(e => {
            if(usuarioAtual == e.id) usuario = "P";
          });

          switch (usuario) {
            case "A":
              html += `
              <thead>
                <tr>
                  <th>Disciplina</th>
                  <th>Bimestre</th>
                  <th>Nota</th>
                  <th>Faltas</th>
                  <th>Situação</th>
                </tr>
              </thead>
              <tbody>`;

              notas.forEach(e => {
                if(usuarioAtual == e.aluno){
                  let disciplina = disciplinas.find(a => a.id === e.disciplina);
                  let situacao;

                  if(e.nota < 3){
                    situacao = `<span class="badge badge-danger">Reprovado</span>`;
                  } else if(e.nota < 6){
                    situacao = `<span class="badge badge-warning">Recuperação</span>`;
                  } else{
                    situacao = `<span class="badge badge-success">Aprovado</span>`;
                  }
                  
                  html += `
                  <tr>
                    <td>${disciplina.nome}</td>
                    <td>${e.bimestre}</td>
                    <td>${e.nota}</td>
                    <td>${e.faltas}</td>
                    <td>${situacao}</td>
                  </tr>
                  `;    
                }
              });
              html += `</tbody>`;
              tabela.innerHTML = html;
              break;
          
            default:
              break;
          }
          
      }
  
      function excluirTurma(id) {      
        localStorage.removeItem("notas");
        let lista_aux = [];
        
        notas.forEach(e => {
            if (id != e.id) {
                lista_aux.push(e);
            }
        });
  
        localStorage.setItem('notas', JSON.stringify(lista_aux));
        notas = JSON.parse(localStorage.getItem('notas')) || [];
        carregarNotas();
      }
  
      function selected_all() {
          let check_box_all = document.querySelector("#ckTodos");
          let check_list = document.querySelectorAll("[data-id]");
          if(check_box_all.checked){
              check_list.forEach(ck_item => {
                  ck_item.checked = check_box_all.checked;
              });
          } else{
              for (let ck_item of check_list) {
                  ck_item.checked = check_box_all.checked;
              }
          }
      }
  
      function del_selected_item() {        
          let check_list = document.querySelectorAll("[data-id]");
          if (check_list.length > 0) {
              check_list.forEach(ck_item => {
                  if(ck_item.checked){ excluirTurma(parseInt(ck_item.dataset.id)); }
              });        
          } else { alert("Não há item para ser excluídos")}
          let check_box_all = document.querySelector("#ckTodos");
          check_box_all.checked = false;
      }
  
      // Carregar notas ao carregar a página
      document.addEventListener("DOMContentLoaded", ()=>{
          carregarNotas();
  
          let ckTodos = document.querySelector("#ckTodos");
          ckTodos.addEventListener("change",selected_all,false);
          
          let btn_select_del = document.querySelector("#btnExcluirSelecionados");
          btn_select_del.addEventListener("click",del_selected_item,false);
  
          let check_box_all = document.querySelector("#ckTodos");
          check_box_all.checked = false;
      });
    </script>
  </body>
</html>
